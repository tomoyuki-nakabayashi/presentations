### 極めて高い安全性を保証するRustでの組込み開発

---

### Rust (ラスト)

Mozillaが支援するオープンソースの**システムプログラミング言語**

言語の目的として、以下の3つを挙げている

- 速度
- 並行性
- 安全性

GCがなく、バイナリの動作速度は[C言語に匹敵](https://github.com/ixy-languages/ixy-languages)する。
強力な型システムとリソース管理システムにより、コンパイルできた時点で、**メモリセーフ**かつ**スレッドセーフ**であることが保証される。

---

### 安全性の観点で見たCとRustの違い

プログラマに与えるものと、負わせるもの。

C言語は、**自由**を与えて、**責任**を課す。

Rustは、**義務**を課して、**保証**を与える。

C言語でのコーディングは自然石を使った壁の構築、対して、Rustでのコーディングは加工された石を使った壁の構築

---

### 安全性の定量的な比較

[Rustで普通にプログラミングするだけでMISRA-Cのルールを90%満足できる](https://blog.hatena.ne.jp/tomo-wait-for-it-yuki/tomo-wait-for-it-yuki.hatenablog.com/edit?entry=98012380858802545)

Rustでコンパイルが通った時点で、MISRA-Cの**80%**のコーディングルールを満たしている。
Rustのデフォルトツールを使うと、さらに、10%のルールを満たす。

[The Challenge of Using C in Safety-Critical Applications](https://static1.squarespace.com/static/5a60ec649f8dce866f011db6/t/5ad016871ae6cf72ec208cb8/1523586697234/The+Challenge+of+Using+C+in+Safety-Critical+Applications.pdf)

上記論文では、有料のMISRA-Cチェックツールで検出できないバグが、Rustでコンパイルエラーとなる例を示している。

`Rustコンパイラ > C + コーディング基準 + 静的解析ツール`

### 自由度と安全性の定性的な比較

| 項目 | C言語 | Rust |
| --- | --- | --- |
| 記述の自由度 | 極めて高い | 強い型付けシステム、所有権、借用、ライフタイムというルールを守る義務 |
| 安全性の高め方 | 職人芸と外部ツール、動的プロファイル | コンパイラでのルールチェック |
| 安全でないコード | 動作する | コンパイルエラーになる |
| 安全でないコードの特定方法 | 把握が困難 | `unsafe`ブロック内にしか書けない |
| 安全性を保証する責任は | プログラマにある | 一部はプログラマ、ルールの範囲内はコンパイラが保証する |

---

### Rustとはどういう言語か？

> Rustを使い始めてわかったのは、C/C++では長い間かけてゆっくり学んでいたような「良い書き方」を学ばないことには、
> Rustではプログラムをコンパイルすることすらできない、ということだ。
> Rustは2,3日でまずは手早く覚えて、後から難しい点、技術的な点、良い書き方などを学べるような言語ではないことを強調したい。
> Rustでは厳密な安全性についてただちに学ばなければならず、最初のうちはあまり快適には感じないだろう。
> しかし、このことは、プログラムをコンパイルするということが本来どういうことだったかを思い出させてくれたように思う。
> 
> Mitchell Nordine

C言語でも同様に安全性を考える必要があるが、Rustではコンパイルエラーになるので、最初は大変。
でも、それはそもそも必要なコストで、実行時のバグ修正より遥かに生産的。